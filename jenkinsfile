pipeline {
    //agent any
    agent { 
        node {
            label 'Node1'
        }
    }
    parameters{
        choice(name: 'ACTION', choices:['deploy', 'delete'], description: 'Choose the action to perform: ' )
    }
    stages {
        stage('Deploy to kubernetes cluster') {
            steps {
                script{
                    if(params.ACTION == 'deploy'){
                        echo 'Deploying.......'
                        ansiblePlaybook (
                            credentialsId: 'a86a4b63-4410-45e8-b78e-225a9ca0a811',
                            disableHostKeyChecking: true,
                            installation: 'Ansible',
                            inventory: 'Ansible/inventory.k8s.yml',
                            playbook: 'Ansible/deploy_playbook.yml',
                            colorized: true
                        )
                    }
                    else(params.ACTION == 'delete'){
                        echo 'Delete Deployment.......'
                        ansiblePlaybook (
                            credentialsId: 'a86a4b63-4410-45e8-b78e-225a9ca0a811',
                            disableHostKeyChecking: true,
                            installation: 'Ansible',
                            inventory: 'Ansible/inventory.k8s.yml',
                            playbook: 'Ansible/delete_playbook.yml',
                            colorized: true
                        )
                    }
                } 
            }
        }
    }
}
