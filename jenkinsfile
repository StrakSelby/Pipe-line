pipeline {
    //agent any
    agent { 
        node {
            label 'Node1'
        }
    }
    stages {
        stage('Setup Nginx Ingress') {
            steps{
                sh '''
                kubectl create ns ingress-nginx
                kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.3.0/deploy/static/provider/cloud/deploy.yaml
                '''
            }
        }
        stage('Execute Ansible Playbook') {
            steps {
                echo 'Running playbook.......'
                ansiblePlaybook (
                    credentialsId: 'ffd31fac-a855-4b38-8cb8-241d49f9944d',
                    disableHostKeyChecking: true,
                    installation: 'Ansible',
                    inventory: 'Ansible/inventory.k8s.yml',
                    playbook: 'Ansible/playbook.yml',
                    colorized: true
                )
            }
        }
    }
}
